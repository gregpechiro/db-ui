<!DOCTYPE html>
<html>
	<head>
		<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
		<script src="//code.jquery.com/ui/1.11.2/jquery-ui.min.js"></script>
		<link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
		<link rel="stylesheet" href="css/menu.css">
		<style type="text/css">
			.editable { padding: 10px; float: left; margin: 0 10px 10px 0; border:1px solid red;}
		</style>
		<title>Test</title>
	</head>
	<body>
		<br><br>
		<div>
			<button id="cler">Clear</button>
			<button id="fill">Fill</button>
			<button id="add">Add</button>
		</div>
		<div>
			<label>Style</label><br>
			<button class="switchStyle" data-css="css/roundStyle.css">Round</button>
			<button class="switchStyle" data-css="css/squareStyle.css">Square</button>
		</div>
		<div>
			<label>Theme</label><br>
			<button class="switchTheme" data-css="">Default</button>
			<button class="switchTheme" data-css="css/blueTheme.css">Blue</button>
			<button class="switchTheme" data-css="css/greenTheme.css">Green</button>
		</div>
		<div id="content"></div>

		<div id="editModal">
			<div id="editForm">
				<div class="label">
					<label>Type</label>
				</div>
				<select id="type" name="type">
					<option value="form">Form</option>
					<option value="table">Table</option>
					<option value="iframe">iFrame</option>
				</select>
				<div id="editInner">
					<div class="label">
						<label>Object</label>
					</div>
					<input type="text" class="menu" id="resource" name="resource" value="">
					<br><br>
					<div id="all-options">
						<label>Fields</label>
						<div id="option0">
							<span name="option">
								<input id="option0" type="text" class="menu" name="fields" placeholder="Name">
								<select id="option0" class="menu">
									<option value="text">Text</option>
									<option value="number">Number</option>
									<option value="boolean">Boolean</option>
									<option value="password">Password</option>
									<option value="date">Date</option>
								</select>
							</span>
						</div>
					</div>
					<button onclick="addOption()">Add Option</button>
				</div>
			</div>
		</div>

		<div id="next-option-input" hidden="true">
			<div id="add-option" class="extra">
				<span name="option">
					<input type="text" name="fields" class="menu" placeholder="Name">
					<select name="type" class="menu">
						<option value="text">Text</option>
						<option value="number">Number</option>
						<option value="boolean">Boolean</option>
						<option value="email">Email</option>
						<option value="password">Password</option>
						<option value="date">Date</option>
					</select>
					<button>X</button>
				</span>
			</div>
		</div>

		<div id="next-option-div" hidden="true">
			<div id="add-option" class="extra"></div>
		</div>


		<div id="fields" hidden="true">
			<div class="label">
				<label>Object</label>
			</div>
			<input type="text" class="menu" id="resource" name="resource" value="">
			<br><br>
			<div id="all-options">
				<label>Fields</label>
				<div id="option0">
					<span name="option">
						<input id="option0" type="text" class="menu" name="fields" placeholder="Name">
						<select id="option0" class="menu">
							<option value="text">Text</option>
							<option value="number">Number</option>
							<option value="boolean">Boolean</option>
							<option value="password">Password</option>
							<option value="date">Date</option>
						</select>
					</span>
				</div>
			</div>
			<button onclick="addOption()">Add Option</button>
		</div>

		<div id="iframe" hidden="true">
			<div class="label">
				<label>URL</label>
			</div>
			<input type="text" class="menu" id="resource" name="resource">
		</div>

		<script src="js/gen.js"></script>
		<script src="js/menu.js"></script>

		<script type="text/javascript" id="code">

			// init variables
			var components = {};
			var editing;
			var i = 0;
			var addOptionDiv = 'div[id="all-options"] div[id="add-option"]';
			var count = 1;
			var currentTheme = '';
			var currentStyle = '';

			// initialize editable html spans
			function init() {
				$('.editable').draggable({
					grid: [ 35, 35 ],
					stop: function( event, ui ) {savePosition(ui);}
				});
				$('.editable' ).resizable({
					grid: [ 35, 35 ],
					stop: function( event, ui ) {saveSize(ui)}
				});
				$('.editable').click(function() {
					edit(this.id);
				});
			}

			// save size of current component
			function saveSize(ui) {
				components[ui.helper[0].id].height = ui.size.height;
				components[ui.helper[0].id].width = ui.size.width;
				if (components[ui.helper[0].id].type === 'iframe') {
					add(components[ui.helper[0].id]);
					deleteComponent(ui.helper[0].id);
				}
			}

			// save position of current component
			function savePosition(ui) {
				components[ui.helper[0].id].left = ui.position.left
				components[ui.helper[0].id].top = ui.position.top
			}

			// delete component from html an components list
			function deleteComponent(id) {
				$('span[id="' + id + '"]').remove();
				$('#editModal').dialog('option', 'title', 'Add');
				delete components[id];
				editing = null;
				resetEditForm();
				var buttons = $('#editModal').dialog('option', 'buttons');
				`buttons[1]`.text = "Cancel";
				$('#editModal').dialog('option', 'buttons', buttons);
			}

			// pretty print all snake case camel case or combination
			function makeTitle(s) {
				var cap = false;
				var newS = s[0].toUpperCase();
				for (var i = 1; i < s.length; i++) {
					if (cap) {
						newS += s[i].toUpperCase();
						cap = false;
					} else if (s[i] === '-' || s[i] === '_') {
						newS += ' ';
						cap = true;
					} else if (s[i] === s[i].toUpperCase()) {
						newS += ' ' + s[i];
					} else {
						newS += s[i];
					}
				}
				return newS;
			}

			// dynamically change css files
			function changeCSS(cssFile, cssHref, style) {
				var oldLink = $('link[href="' + cssHref + '"]');
				if (cssFile === '') {
					oldLink.remove();
				} else {
        			var newLink = $('<link></link>');
        			newLink.attr('rel', 'stylesheet');
        			newLink.attr('type', 'text/css');
        			newLink.attr('href', cssFile);
					if (oldLink.length !== 0) {
						$(oldLink).replaceWith(newLink);
					} else {
						if (style) {
							$('head').prepend(newLink);
						} else {
							$('head').append(newLink);
						}
					}
				}
    		}

			$(document).ready(function() {
				//init();
				menuInit();

				// button selectors
				$('button[id="add"]').click(function() {
					editing = null;
					resetEditForm();
					var buttons = $('#editModal').dialog('option', 'buttons');
					buttons[1].text = "Cancel";
					if  (buttons.length === 3) {
						buttons.splice(3, 1);
					}
					$('#editModal').dialog('option', 'buttons', buttons);
					$('#editModal').dialog('option', 'title', 'Add');
					$('div[id="editModal"]').dialog('open');
				});

				$('button[id="cler"]').click(function() {
					$('div[id="content"]').html('');
				});

				$('button[id="fill"]').click(function() {
					display(components);
				});

				$('button.switchStyle').click(function() {
					changeCSS(this.getAttribute('data-css'), currentStyle, true);
					currentStyle = this.getAttribute('data-css');
				});

				$('button.switchTheme').click(function() {
					changeCSS(this.getAttribute('data-css'), currentTheme, false);
					currentTheme = this.getAttribute('data-css');
				});

				$('select[id="type"]').change(function() {
					var type = $('select[id="type"]').val();
					switch (type) {
						case 'form':
						case 'table':
							$('div[id="editInner"]').html($('div[id="fields"]').html());
							break;
						case 'iframe':
							$('div[id="editInner"]').html($('div[id="iframe"]').html());
							break;
					}
				});

			});

		</script>

	</body>
</html>
